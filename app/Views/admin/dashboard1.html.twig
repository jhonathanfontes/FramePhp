{% extends "admin/layout.twig" %}

{% block title %}Dashboard - {{ empresa.nome_fantasia }}{% endblock %}
{% block page_title %}Dashboard{% endblock %}

{% block content %}
    <!-- Cards de Estat√≠sticas -->
    <div class="grid grid-4">
        <div class="card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">Vendas Hoje</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #3498db; margin: 0;">{{ vendasHoje }}</p>
                </div>
                <div style="font-size: 2.5rem;">üí∞</div>
            </div>
        </div>
        
        <div class="card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">Vendas do M√™s</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #27ae60; margin: 0;">{{ vendasMes }}</p>
                </div>
                <div style="font-size: 2.5rem;">üìä</div>
            </div>
        </div>
        
        <div class="card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">Receita do M√™s</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #e74c3c; margin: 0;">R$ {{ "%.2f"|format(receitaMes) }}</p>
                </div>
                <div style="font-size: 2.5rem;">üíµ</div>
            </div>
        </div>
        
        <div class="card">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <h3 style="color: #666; font-size: 0.9rem; margin-bottom: 0.5rem;">Baixo Estoque</h3>
                    <p style="font-size: 2rem; font-weight: bold; color: #f39c12; margin: 0;">{{ produtosBaixoEstoque }}</p>
                </div>
                <div style="font-size: 2.5rem;">‚ö†Ô∏è</div>
            </div>
        </div>
    </div>

    <div class="grid grid-2">
        <!-- Vendas Recentes -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Vendas Recentes</h2>
            </div>
            
            {% if vendasRecentes %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>Pedido</th>
                            <th>Cliente</th>
                            <th>Total</th>
                            <th>Status</th>
                            <th>Data</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for venda in vendasRecentes %}
                            <tr>
                                <td>
                                    <a href="/admin/vendas/{{ venda.id }}" style="color: #3498db; text-decoration: none;">
                                        #{{ venda.numero_pedido }}
                                    </a>
                                </td>
                                <td>{{ venda.pessoa ? venda.pessoa.nome : 'Cliente n√£o identificado' }}</td>
                                <td style="font-weight: bold;">R$ {{ "%.2f"|format(venda.total) }}</td>
                                <td>
                                    <span class="badge 
                                        {% if venda.status == 'pendente' %}badge-warning{% endif %}
                                        {% if venda.status == 'aprovado' %}badge-info{% endif %}
                                        {% if venda.status == 'em_preparo' %}badge-info{% endif %}
                                        {% if venda.status == 'enviado' %}badge-info{% endif %}
                                        {% if venda.status == 'entregue' %}badge-success{% endif %}
                                        {% if venda.status == 'cancelado' %}badge-danger{% endif %}
                                    ">
                                        {{ venda.status|title }}
                                    </span>
                                </td>
                                <td>{{ venda.data_venda|date('d/m/Y H:i') }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="/admin/vendas" class="btn btn-primary">Ver Todas as Vendas</a>
                </div>
            {% else %}
                <p style="text-align: center; color: #666; padding: 2rem;">Nenhuma venda encontrada</p>
            {% endif %}
        </div>

        <!-- Produtos Mais Vendidos -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Produtos Mais Vendidos</h2>
            </div>
            
            {% if produtosMaisVendidos %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>C√≥digo</th>
                            <th>Pre√ßo</th>
                            <th>Estoque</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for produto in produtosMaisVendidos %}
                            <tr>
                                <td>
                                    <a href="/admin/produtos/{{ produto.id }}" style="color: #3498db; text-decoration: none;">
                                        {{ produto.nome }}
                                    </a>
                                </td>
                                <td>{{ produto.codigo }}</td>
                                <td style="font-weight: bold;">R$ {{ "%.2f"|format(produto.preco) }}</td>
                                <td>
                                    <span class="badge {% if produto.estoque <= produto.estoque_minimo %}badge-danger{% else %}badge-success{% endif %}">
                                        {{ produto.estoque }}
                                    </span>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="/admin/produtos" class="btn btn-primary">Ver Todos os Produtos</a>
                </div>
            {% else %}
                <p style="text-align: center; color: #666; padding: 2rem;">Nenhum produto vendido este m√™s</p>
            {% endif %}
        </div>
    </div>

    <!-- Gr√°ficos e An√°lises -->
    <div class="grid grid-2">
        <!-- Gr√°fico de Vendas (Simulado) -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Vendas dos √öltimos 7 Dias</h2>
            </div>
            <div style="height: 300px; display: flex; align-items: end; justify-content: space-around; padding: 2rem;">
                <div style="background: #3498db; width: 40px; height: 60px; border-radius: 5px 5px 0 0;"></div>
                <div style="background: #3498db; width: 40px; height: 80px; border-radius: 5px 5px 0 0;"></div>
                <div style="background: #3498db; width: 40px; height: 120px; border-radius: 5px 5px 0 0;"></div>
                <div style="background: #3498db; width: 40px; height: 90px; border-radius: 5px 5px 0 0;"></div>
                <div style="background: #3498db; width: 40px; height: 150px; border-radius: 5px 5px 0 0;"></div>
                <div style="background: #3498db; width: 40px; height: 100px; border-radius: 5px 5px 0 0;"></div>
                <div style="background: #3498db; width: 40px; height: 130px; border-radius: 5px 5px 0 0;"></div>
            </div>
            <div style="display: flex; justify-content: space-around; margin-top: 1rem; font-size: 0.8rem; color: #666;">
                <span>Seg</span>
                <span>Ter</span>
                <span>Qua</span>
                <span>Qui</span>
                <span>Sex</span>
                <span>S√°b</span>
                <span>Dom</span>
            </div>
        </div>

        <!-- Status do Sistema -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">Status do Sistema</h2>
            </div>
            <div style="padding: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #eee;">
                    <span>Produtos Ativos</span>
                    <span class="badge badge-success">{{ empresa.produtos().where('ativo', true).count() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #eee;">
                    <span>Clientes Cadastrados</span>
                    <span class="badge badge-info">{{ empresa.pessoas().where('ativo', true).count() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #eee;">
                    <span>Pedidos Pendentes</span>
                    <span class="badge badge-warning">{{ empresa.vendas().where('status', 'pendente').count() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0;">
                    <span>Produtos em Baixo Estoque</span>
                    <span class="badge badge-danger">{{ produtosBaixoEstoque }}</span>
                </div>
            </div>
        </div>
    </div>

    <!-- A√ß√µes R√°pidas -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">A√ß√µes R√°pidas</h2>
        </div>
        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
            <a href="/admin/produtos/create" class="btn btn-primary">‚ûï Novo Produto</a>
            <a href="/admin/vendas/create" class="btn btn-primary">üí∞ Nova Venda</a>
            <a href="/admin/pessoas/create" class="btn btn-primary">üë• Novo Cliente</a>
            <a href="/admin/estoque" class="btn btn-primary">üìã Controle de Estoque</a>
            <a href="/admin/relatorios" class="btn btn-primary">üìà Relat√≥rios</a>
            <a href="/admin/configuracoes" class="btn btn-primary">‚öôÔ∏è Configura√ß√µes</a>
        </div>
    </div>

    <script>
        // Simular dados em tempo real
        setInterval(function() {
            // Aqui voc√™ pode adicionar atualiza√ß√µes em tempo real
            console.log('Dashboard atualizado');
        }, 30000); // Atualiza a cada 30 segundos
    </script>
{% endblock %} 
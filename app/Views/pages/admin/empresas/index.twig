
{% extends 'layouts/admin.html.twig' %}

{% block title %}Gerenciar Empresas{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Empresas</h1>
    <a href="/admin/empresas/create" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        Nova Empresa
    </a>
</div>

<div class="card">
    <div class="card-header">
        <h3>Lista de Empresas</h3>
    </div>
    <div class="card-body">
        {% if empresas|length > 0 %}
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Razão Social</th>
                        <th>Nome Fantasia</th>
                        <th>CNPJ</th>
                        <th>Email</th>
                        <th>Status</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for empresa in empresas %}
                    <tr>
                        <td>{{ empresa.id_empresa }}</td>
                        <td>{{ empresa.razao_social }}</td>
                        <td>{{ empresa.nome_fantasia }}</td>
                        <td>{{ empresa.cnpj }}</td>
                        <td>{{ empresa.email }}</td>
                        <td>
                            <span class="badge badge-{{ empresa.status == 'ativo' ? 'success' : 'danger' }}">
                                {{ empresa.status|title }}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <a href="/admin/empresas/{{ empresa.id_empresa }}/edit" 
                                   class="btn btn-sm btn-outline-primary" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <a href="/admin/empresas/{{ empresa.id_empresa }}/lojas" 
                                   class="btn btn-sm btn-outline-info" title="Lojas">
                                    <i class="fas fa-store"></i>
                                </a>
                                <button class="btn btn-sm btn-outline-danger" 
                                        onclick="confirmDelete({{ empresa.id_empresa }})" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-building fa-3x text-muted"></i>
            <h3>Nenhuma empresa cadastrada</h3>
            <p>Clique no botão "Nova Empresa" para começar.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function confirmDelete(empresaId) {
    if (confirm('Tem certeza que deseja excluir esta empresa? Esta ação não pode ser desfeita.')) {
        // Implementar exclusão via AJAX
        fetch(`/admin/empresas/${empresaId}/delete`, {
            method: 'DELETE',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Erro ao excluir empresa: ' + data.message);
            }
        })
        .catch(error => {
            alert('Erro ao excluir empresa');
            console.error('Error:', error);
        });
    }
}
</script>
{% endblock %}


{% extends "layouts/store.html.twig" %}

{% block title %}{{ produto.pro_nome }}{% endblock %}

{% block content %}
<div class="container">
    <div class="breadcrumb">
        <a href="{{ route('client.home') }}">Início</a> > 
        <a href="{{ route('client.catalogo') }}">Catálogo</a> > 
        {{ produto.pro_nome }}
    </div>

    <div class="product-detail">
        <div class="product-images">
            <div class="main-image">
                <img src="{{ produto.pro_imagem ?? '/assets/images/no-image.jpg' }}" alt="{{ produto.pro_nome }}">
            </div>
        </div>

        <div class="product-info">
            <h1>{{ produto.pro_nome }}</h1>
            <div class="product-code">Código: {{ produto.pro_sku }}</div>
            
            <div class="product-price">
                {% if produto.pro_preco_promocional %}
                    <span class="old-price">De: R$ {{ produto.pro_preco|number_format(2, ',', '.') }}</span>
                    <span class="current-price">Por: R$ {{ produto.pro_preco_promocional|number_format(2, ',', '.') }}</span>
                    <span class="discount">{{ (((produto.pro_preco - produto.pro_preco_promocional) / produto.pro_preco) * 100)|round }}% OFF</span>
                {% else %}
                    <span class="current-price">R$ {{ produto.pro_preco|number_format(2, ',', '.') }}</span>
                {% endif %}
            </div>

            {% if produto.pro_descricao %}
            <div class="product-description">
                <h3>Descrição</h3>
                <p>{{ produto.pro_descricao }}</p>
            </div>
            {% endif %}

            <div class="product-details">
                <h3>Informações do Produto</h3>
                <ul>
                    {% if produto.pro_peso %}
                    <li><strong>Peso:</strong> {{ produto.pro_peso }}</li>
                    {% endif %}
                    {% if produto.pro_dimensoes %}
                    <li><strong>Dimensões:</strong> {{ produto.pro_dimensoes }}</li>
                    {% endif %}
                    <li><strong>Estoque:</strong> {{ produto.pro_estoque > 0 ? produto.pro_estoque ~ ' unidades' : 'Indisponível' }}</li>
                </ul>
            </div>

            {% if produto.pro_estoque > 0 %}
            <form class="add-to-cart-form" data-produto-id="{{ produto.id_produto }}">
                <div class="quantity-selector">
                    <label for="quantidade">Quantidade:</label>
                    <input type="number" id="quantidade" name="quantidade" value="1" min="1" max="{{ produto.pro_estoque }}">
                </div>
                
                <div class="product-actions">
                    <button type="submit" class="btn btn-primary btn-large">
                        Adicionar ao Carrinho
                    </button>
                    <a href="{{ route('client.carrinho') }}" class="btn btn-outline">
                        Ver Carrinho
                    </a>
                </div>
            </form>
            {% else %}
            <div class="product-unavailable">
                <p>Produto indisponível no momento</p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Produtos Relacionados -->
    {% if produtos_relacionados %}
    <section class="related-products">
        <h2>Produtos Relacionados</h2>
        <div class="products-grid">
            {% for produto_relacionado in produtos_relacionados %}
            {% if produto_relacionado.id_produto != produto.id_produto %}
            <div class="product-card">
                <div class="product-image">
                    <img src="{{ produto_relacionado.pro_imagem ?? '/assets/images/no-image.jpg' }}" alt="{{ produto_relacionado.pro_nome }}">
                </div>
                <div class="product-info">
                    <h3>{{ produto_relacionado.pro_nome }}</h3>
                    <div class="product-price">
                        {% if produto_relacionado.pro_preco_promocional %}
                            <span class="old-price">R$ {{ produto_relacionado.pro_preco|number_format(2, ',', '.') }}</span>
                            <span class="current-price">R$ {{ produto_relacionado.pro_preco_promocional|number_format(2, ',', '.') }}</span>
                        {% else %}
                            <span class="current-price">R$ {{ produto_relacionado.pro_preco|number_format(2, ',', '.') }}</span>
                        {% endif %}
                    </div>
                    <div class="product-actions">
                        <a href="{{ route('client.produto', {id: produto_relacionado.id_produto}) }}" class="btn btn-outline">Ver Detalhes</a>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}
        </div>
    </section>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.add-to-cart-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const produtoId = this.dataset.produtoId;
            const quantidade = document.getElementById('quantidade').value;
            
            fetch('{{ route("client.carrinho.adicionar") }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
                },
                body: `produto_id=${produtoId}&quantidade=${quantidade}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Produto adicionado ao carrinho!');
                } else {
                    alert('Erro ao adicionar produto: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao adicionar produto ao carrinho');
            });
        });
    }
});
</script>
{% endblock %}

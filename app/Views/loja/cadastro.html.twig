{% extends "loja/layout.html.twig" %}

{% block title %}Cadastro - {{ empresa.nome_fantasia }}{% endblock %}

{% block content %}
    <div class="auth-page">
        <div class="auth-container">
            <!-- Formul√°rio de Cadastro -->
            <div class="auth-form-container">
                <div class="auth-header">
                    <h1 class="auth-title">üë§ Criar Conta</h1>
                    <p class="auth-subtitle">Cadastre-se para aproveitar todos os benef√≠cios da nossa loja</p>
                </div>

                <form method="POST" action="/loja/cadastro" class="auth-form" id="register-form">
                    <!-- Dados Pessoais -->
                    <div class="form-section">
                        <h3 class="section-subtitle">Dados Pessoais</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="nome" class="form-label">Nome Completo *</label>
                                <input type="text" 
                                       id="nome" 
                                       name="nome" 
                                       class="form-input" 
                                       required
                                       placeholder="Seu nome completo"
                                       value="{{ old.nome }}"
                                       aria-describedby="nome-error">
                                <div id="nome-error" class="error-message" role="alert">
                                    {% if errors.nome %}
                                        {{ errors.nome }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cpf" class="form-label">CPF *</label>
                                <input type="text" 
                                       id="cpf" 
                                       name="cpf" 
                                       class="form-input" 
                                       required
                                       placeholder="000.000.000-00"
                                       value="{{ old.cpf }}"
                                       aria-describedby="cpf-error">
                                <div id="cpf-error" class="error-message" role="alert">
                                    {% if errors.cpf %}
                                        {{ errors.cpf }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="email" class="form-label">E-mail *</label>
                                <input type="email" 
                                       id="email" 
                                       name="email" 
                                       class="form-input" 
                                       required
                                       placeholder="seu@email.com"
                                       value="{{ old.email }}"
                                       aria-describedby="email-error">
                                <div id="email-error" class="error-message" role="alert">
                                    {% if errors.email %}
                                        {{ errors.email }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="telefone" class="form-label">Telefone *</label>
                                <input type="tel" 
                                       id="telefone" 
                                       name="telefone" 
                                       class="form-input" 
                                       required
                                       placeholder="(00) 00000-0000"
                                       value="{{ old.telefone }}"
                                       aria-describedby="telefone-error">
                                <div id="telefone-error" class="error-message" role="alert">
                                    {% if errors.telefone %}
                                        {{ errors.telefone }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Senha -->
                    <div class="form-section">
                        <h3 class="section-subtitle">Senha</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="password" class="form-label">Senha *</label>
                                <div class="password-input-group">
                                    <input type="password" 
                                           id="password" 
                                           name="password" 
                                           class="form-input" 
                                           required
                                           placeholder="M√≠nimo 6 caracteres"
                                           aria-describedby="password-error">
                                    <button type="button" 
                                            class="password-toggle" 
                                            onclick="togglePassword('password')"
                                            aria-label="Mostrar/ocultar senha">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <div id="password-error" class="error-message" role="alert">
                                    {% if errors.password %}
                                        {{ errors.password }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="password_confirmation" class="form-label">Confirmar Senha *</label>
                                <div class="password-input-group">
                                    <input type="password" 
                                           id="password_confirmation" 
                                           name="password_confirmation" 
                                           class="form-input" 
                                           required
                                           placeholder="Digite novamente"
                                           aria-describedby="password-confirmation-error">
                                    <button type="button" 
                                            class="password-toggle" 
                                            onclick="togglePassword('password_confirmation')"
                                            aria-label="Mostrar/ocultar senha">
                                        üëÅÔ∏è
                                    </button>
                                </div>
                                <div id="password-confirmation-error" class="error-message" role="alert">
                                    {% if errors.password_confirmation %}
                                        {{ errors.password_confirmation }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Endere√ßo -->
                    <div class="form-section">
                        <h3 class="section-subtitle">Endere√ßo</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cep" class="form-label">CEP *</label>
                                <input type="text" 
                                       id="cep" 
                                       name="cep" 
                                       class="form-input" 
                                       required
                                       placeholder="00000-000"
                                       value="{{ old.cep }}"
                                       aria-describedby="cep-error">
                                <div id="cep-error" class="error-message" role="alert">
                                    {% if errors.cep %}
                                        {{ errors.cep }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="endereco" class="form-label">Endere√ßo *</label>
                                <input type="text" 
                                       id="endereco" 
                                       name="endereco" 
                                       class="form-input" 
                                       required
                                       placeholder="Rua, Avenida, etc."
                                       value="{{ old.endereco }}"
                                       aria-describedby="endereco-error">
                                <div id="endereco-error" class="error-message" role="alert">
                                    {% if errors.endereco %}
                                        {{ errors.endereco }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="numero" class="form-label">N√∫mero *</label>
                                <input type="text" 
                                       id="numero" 
                                       name="numero" 
                                       class="form-input" 
                                       required
                                       placeholder="123"
                                       value="{{ old.numero }}"
                                       aria-describedby="numero-error">
                                <div id="numero-error" class="error-message" role="alert">
                                    {% if errors.numero %}
                                        {{ errors.numero }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="complemento" class="form-label">Complemento</label>
                                <input type="text" 
                                       id="complemento" 
                                       name="complemento" 
                                       class="form-input" 
                                       placeholder="Apartamento, bloco, etc."
                                       value="{{ old.complemento }}">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="bairro" class="form-label">Bairro *</label>
                                <input type="text" 
                                       id="bairro" 
                                       name="bairro" 
                                       class="form-input" 
                                       required
                                       placeholder="Centro"
                                       value="{{ old.bairro }}"
                                       aria-describedby="bairro-error">
                                <div id="bairro-error" class="error-message" role="alert">
                                    {% if errors.bairro %}
                                        {{ errors.bairro }}
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cidade" class="form-label">Cidade *</label>
                                <input type="text" 
                                       id="cidade" 
                                       name="cidade" 
                                       class="form-input" 
                                       required
                                       placeholder="S√£o Paulo"
                                       value="{{ old.cidade }}"
                                       aria-describedby="cidade-error">
                                <div id="cidade-error" class="error-message" role="alert">
                                    {% if errors.cidade %}
                                        {{ errors.cidade }}
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="estado" class="form-label">Estado *</label>
                            <select id="estado" 
                                    name="estado" 
                                    class="form-select" 
                                    required
                                    aria-describedby="estado-error">
                                <option value="">Selecione o Estado</option>
                                <option value="AC" {% if old.estado == 'AC' %}selected{% endif %}>Acre</option>
                                <option value="AL" {% if old.estado == 'AL' %}selected{% endif %}>Alagoas</option>
                                <option value="AP" {% if old.estado == 'AP' %}selected{% endif %}>Amap√°</option>
                                <option value="AM" {% if old.estado == 'AM' %}selected{% endif %}>Amazonas</option>
                                <option value="BA" {% if old.estado == 'BA' %}selected{% endif %}>Bahia</option>
                                <option value="CE" {% if old.estado == 'CE' %}selected{% endif %}>Cear√°</option>
                                <option value="DF" {% if old.estado == 'DF' %}selected{% endif %}>Distrito Federal</option>
                                <option value="ES" {% if old.estado == 'ES' %}selected{% endif %}>Esp√≠rito Santo</option>
                                <option value="GO" {% if old.estado == 'GO' %}selected{% endif %}>Goi√°s</option>
                                <option value="MA" {% if old.estado == 'MA' %}selected{% endif %}>Maranh√£o</option>
                                <option value="MT" {% if old.estado == 'MT' %}selected{% endif %}>Mato Grosso</option>
                                <option value="MS" {% if old.estado == 'MS' %}selected{% endif %}>Mato Grosso do Sul</option>
                                <option value="MG" {% if old.estado == 'MG' %}selected{% endif %}>Minas Gerais</option>
                                <option value="PA" {% if old.estado == 'PA' %}selected{% endif %}>Par√°</option>
                                <option value="PB" {% if old.estado == 'PB' %}selected{% endif %}>Para√≠ba</option>
                                <option value="PR" {% if old.estado == 'PR' %}selected{% endif %}>Paran√°</option>
                                <option value="PE" {% if old.estado == 'PE' %}selected{% endif %}>Pernambuco</option>
                                <option value="PI" {% if old.estado == 'PI' %}selected{% endif %}>Piau√≠</option>
                                <option value="RJ" {% if old.estado == 'RJ' %}selected{% endif %}>Rio de Janeiro</option>
                                <option value="RN" {% if old.estado == 'RN' %}selected{% endif %}>Rio Grande do Norte</option>
                                <option value="RS" {% if old.estado == 'RS' %}selected{% endif %}>Rio Grande do Sul</option>
                                <option value="RO" {% if old.estado == 'RO' %}selected{% endif %}>Rond√¥nia</option>
                                <option value="RR" {% if old.estado == 'RR' %}selected{% endif %}>Roraima</option>
                                <option value="SC" {% if old.estado == 'SC' %}selected{% endif %}>Santa Catarina</option>
                                <option value="SP" {% if old.estado == 'SP' %}selected{% endif %}>S√£o Paulo</option>
                                <option value="SE" {% if old.estado == 'SE' %}selected{% endif %}>Sergipe</option>
                                <option value="TO" {% if old.estado == 'TO' %}selected{% endif %}>Tocantins</option>
                            </select>
                            <div id="estado-error" class="error-message" role="alert">
                                {% if errors.estado %}
                                    {{ errors.estado }}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Termos e Condi√ß√µes -->
                    <div class="form-section">
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" 
                                       name="aceite_termos" 
                                       id="aceite_termos"
                                       required
                                       {% if old.aceite_termos %}checked{% endif %}>
                                <span class="checkmark"></span>
                                Li e aceito os <a href="/termos" target="_blank">Termos de Uso</a> e 
                                <a href="/privacidade" target="_blank">Pol√≠tica de Privacidade</a> *
                            </label>
                            <div id="aceite_termos-error" class="error-message" role="alert">
                                {% if errors.aceite_termos %}
                                    {{ errors.aceite_termos }}
                                {% endif %}
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" 
                                       name="newsletter" 
                                       id="newsletter"
                                       {% if old.newsletter %}checked{% endif %}>
                                <span class="checkmark"></span>
                                Desejo receber ofertas e novidades por e-mail
                            </label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg auth-btn">
                        <span class="btn-text">Criar Conta</span>
                        <span class="btn-loading">‚è≥ Criando conta...</span>
                    </button>
                </form>

                <div class="auth-divider">
                    <span>ou</span>
                </div>

                <div class="social-login">
                    <button class="btn btn-social btn-google" onclick="cadastroSocial('google')">
                        <span class="social-icon">üîç</span>
                        Cadastrar com Google
                    </button>
                    
                    <button class="btn btn-social btn-facebook" onclick="cadastroSocial('facebook')">
                        <span class="social-icon">üìò</span>
                        Cadastrar com Facebook
                    </button>
                </div>

                <div class="auth-footer">
                    <p>J√° tem uma conta?</p>
                    <a href="/loja/login" class="btn btn-secondary">
                        Fazer Login
                    </a>
                </div>
            </div>

            <!-- Banner Lateral -->
            <div class="auth-banner">
                <div class="banner-content">
                    <div class="banner-icon">üéâ</div>
                    <h2 class="banner-title">Junte-se a n√≥s!</h2>
                    <p class="banner-text">
                        Crie sua conta e aproveite todos os benef√≠cios:
                    </p>
                    <ul class="banner-features">
                        <li>‚úÖ Compras mais r√°pidas</li>
                        <li>‚úÖ Hist√≥rico de pedidos</li>
                        <li>‚úÖ Lista de favoritos</li>
                        <li>‚úÖ Cupons exclusivos</li>
                        <li>‚úÖ Frete gr√°tis</li>
                        <li>‚úÖ Atendimento priorit√°rio</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* ===== AUTH PAGE ===== */
        .auth-page {
            min-height: calc(100vh - 200px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg) 0;
        }
        
        .auth-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            max-width: 1200px;
            width: 100%;
            background: var(--bg-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-hover);
            overflow: hidden;
        }
        
        /* ===== AUTH FORM ===== */
        .auth-form-container {
            padding: var(--spacing-xl);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .auth-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }
        
        .auth-title {
            font-size: clamp(1.5rem, 4vw, 2rem);
            color: var(--text-color);
            margin-bottom: var(--spacing-sm);
        }
        
        .auth-subtitle {
            color: var(--text-light);
            font-size: 1rem;
        }
        
        .auth-form {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-lg);
        }
        
        /* ===== FORM SECTIONS ===== */
        .form-section {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: var(--spacing-lg);
        }
        
        .form-section:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }
        
        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-color);
            margin-bottom: var(--spacing-md);
            font-weight: 600;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--spacing-md);
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .form-input,
        .form-select {
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: 2px solid var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .password-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .password-toggle {
            position: absolute;
            right: var(--spacing-sm);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: var(--text-light);
            padding: 0;
        }
        
        .password-toggle:hover {
            color: var(--primary-color);
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            min-height: 1rem;
        }
        
        /* ===== CHECKBOX ===== */
        .checkbox-label {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-xs);
            cursor: pointer;
            font-size: 0.9rem;
            color: var(--text-color);
            line-height: 1.4;
        }
        
        .checkbox-label input[type="checkbox"] {
            display: none;
        }
        
        .checkmark {
            width: 18px;
            height: 18px;
            border: 2px solid var(--border-color);
            border-radius: 3px;
            position: relative;
            transition: var(--transition);
            flex-shrink: 0;
            margin-top: 2px;
        }
        
        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-white);
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .checkbox-label a {
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .checkbox-label a:hover {
            text-decoration: underline;
        }
        
        /* ===== AUTH BUTTON ===== */
        .auth-btn {
            width: 100%;
            margin: var(--spacing-md) 0;
            position: relative;
            overflow: hidden;
        }
        
        .btn-loading {
            display: none;
        }
        
        .auth-btn.loading .btn-text {
            display: none;
        }
        
        .auth-btn.loading .btn-loading {
            display: inline;
        }
        
        /* ===== SOCIAL LOGIN ===== */
        .auth-divider {
            text-align: center;
            margin: var(--spacing-lg) 0;
            position: relative;
        }
        
        .auth-divider::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--border-color);
        }
        
        .auth-divider span {
            background: var(--bg-white);
            padding: 0 var(--spacing-sm);
            color: var(--text-light);
            font-size: 0.9rem;
        }
        
        .social-login {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }
        
        .btn-social {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            background: var(--bg-white);
            color: var(--text-color);
            transition: var(--transition);
        }
        
        .btn-social:hover {
            background: var(--bg-light);
            transform: translateY(-1px);
        }
        
        .btn-google:hover {
            border-color: #db4437;
            color: #db4437;
        }
        
        .btn-facebook:hover {
            border-color: #4267B2;
            color: #4267B2;
        }
        
        .social-icon {
            font-size: 1.2rem;
        }
        
        /* ===== AUTH FOOTER ===== */
        .auth-footer {
            text-align: center;
            margin-top: auto;
        }
        
        .auth-footer p {
            color: var(--text-light);
            margin-bottom: var(--spacing-sm);
        }
        
        /* ===== AUTH BANNER ===== */
        .auth-banner {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: var(--text-white);
            padding: var(--spacing-xl);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .banner-content {
            max-width: 400px;
        }
        
        .banner-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
        }
        
        .banner-title {
            font-size: 1.8rem;
            margin-bottom: var(--spacing-md);
        }
        
        .banner-text {
            margin-bottom: var(--spacing-lg);
            opacity: 0.9;
        }
        
        .banner-features {
            list-style: none;
            text-align: left;
        }
        
        .banner-features li {
            margin-bottom: var(--spacing-sm);
            font-size: 0.9rem;
        }
        
        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 1024px) {
            .auth-container {
                grid-template-columns: 1fr;
                max-width: 600px;
            }
            
            .auth-banner {
                display: none;
            }
        }
        
        @media (max-width: 768px) {
            .auth-page {
                padding: var(--spacing-md) 0;
            }
            
            .auth-form-container {
                padding: var(--spacing-lg);
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .social-login {
                gap: var(--spacing-xs);
            }
        }
        
        @media (max-width: 480px) {
            .auth-container {
                margin: 0 var(--spacing-sm);
                border-radius: var(--border-radius);
            }
            
            .auth-form-container {
                padding: var(--spacing-md);
            }
            
            .auth-title {
                font-size: 1.5rem;
            }
        }
    </style>

    <script>
        // M√°scaras para campos
        function aplicarMascara(input, mask) {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (mask === 'cpf') {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (mask === 'telefone') {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (mask === 'cep') {
                    value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
                }
                
                e.target.value = value;
            });
        }
        
        // Aplicar m√°scaras
        aplicarMascara(document.getElementById('cpf'), 'cpf');
        aplicarMascara(document.getElementById('telefone'), 'telefone');
        aplicarMascara(document.getElementById('cep'), 'cep');
        
        // Toggle password visibility
        function togglePassword(fieldId) {
            const passwordInput = document.getElementById(fieldId);
            const toggleBtn = passwordInput.parentElement.querySelector('.password-toggle');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleBtn.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                toggleBtn.textContent = 'üëÅÔ∏è';
            }
        }
        
        // Buscar CEP
        document.getElementById('cep').addEventListener('blur', function() {
            const cep = this.value.replace(/\D/g, '');
            if (cep.length === 8) {
                buscarCep(cep);
            }
        });
        
        function buscarCep(cep) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('endereco').value = data.logradouro;
                        document.getElementById('bairro').value = data.bairro;
                        document.getElementById('cidade').value = data.localidade;
                        document.getElementById('estado').value = data.uf;
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar CEP:', error);
                });
        }
        
        // Form submission
        document.getElementById('register-form').addEventListener('submit', function(e) {
            if (!validarFormulario()) {
                e.preventDefault();
                return;
            }
            
            const button = document.querySelector('.auth-btn');
            button.classList.add('loading');
            
            // Simular delay de envio
            setTimeout(() => {
                button.classList.remove('loading');
            }, 2000);
        });
        
        // Valida√ß√£o do formul√°rio
        function validarFormulario() {
            let isValid = true;
            
            // Limpar mensagens de erro
            document.querySelectorAll('.error-message').forEach(el => {
                el.textContent = '';
            });
            
            // Validar campos obrigat√≥rios
            const requiredFields = [
                'nome', 'cpf', 'email', 'telefone', 'password', 
                'password_confirmation', 'cep', 'endereco', 'numero', 
                'bairro', 'cidade', 'estado'
            ];
            
            requiredFields.forEach(field => {
                const input = document.getElementById(field);
                const error = document.getElementById(field + '-error');
                
                if (!input.value.trim()) {
                    error.textContent = 'Este campo √© obrigat√≥rio';
                    isValid = false;
                }
            });
            
            // Validar email
            const email = document.getElementById('email');
            const emailError = document.getElementById('email-error');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email.value && !emailRegex.test(email.value)) {
                emailError.textContent = 'E-mail inv√°lido';
                isValid = false;
            }
            
            // Validar CPF
            const cpf = document.getElementById('cpf');
            const cpfError = document.getElementById('cpf-error');
            
            if (cpf.value && !validarCPF(cpf.value)) {
                cpfError.textContent = 'CPF inv√°lido';
                isValid = false;
            }
            
            // Validar senha
            const password = document.getElementById('password');
            const passwordError = document.getElementById('password-error');
            
            if (password.value && password.value.length < 6) {
                passwordError.textContent = 'A senha deve ter pelo menos 6 caracteres';
                isValid = false;
            }
            
            // Validar confirma√ß√£o de senha
            const passwordConfirmation = document.getElementById('password_confirmation');
            const passwordConfirmationError = document.getElementById('password-confirmation-error');
            
            if (passwordConfirmation.value && password.value !== passwordConfirmation.value) {
                passwordConfirmationError.textContent = 'As senhas n√£o coincidem';
                isValid = false;
            }
            
            // Validar aceite dos termos
            const aceiteTermos = document.getElementById('aceite_termos');
            const aceiteTermosError = document.getElementById('aceite_termos-error');
            
            if (!aceiteTermos.checked) {
                aceiteTermosError.textContent = 'Voc√™ deve aceitar os termos para continuar';
                isValid = false;
            }
            
            return isValid;
        }
        
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            if (cpf.length !== 11) return false;
            
            // Verificar d√≠gitos repetidos
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            // Validar d√≠gitos verificadores
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.charAt(9))) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.charAt(10))) return false;
            
            return true;
        }
        
        // Social cadastro
        function cadastroSocial(provider) {
            const button = event.target;
            const originalText = button.innerHTML;
            
            button.disabled = true;
            button.innerHTML = `<span class="social-icon">‚è≥</span> Conectando...`;
            
            // Simular cadastro social
            setTimeout(() => {
                button.disabled = false;
                button.innerHTML = originalText;
                
                // Redirecionar para OAuth
                window.location.href = `/loja/auth/${provider}`;
            }, 1000);
        }
        
        // Valida√ß√£o em tempo real
        document.getElementById('email').addEventListener('blur', function() {
            const email = this.value;
            const error = document.getElementById('email-error');
            
            if (email && !isValidEmail(email)) {
                error.textContent = 'E-mail inv√°lido';
            } else {
                error.textContent = '';
            }
        });
        
        document.getElementById('password').addEventListener('blur', function() {
            const password = this.value;
            const error = document.getElementById('password-error');
            
            if (password && password.length < 6) {
                error.textContent = 'A senha deve ter pelo menos 6 caracteres';
            } else {
                error.textContent = '';
            }
        });
        
        document.getElementById('password_confirmation').addEventListener('blur', function() {
            const password = document.getElementById('password').value;
            const confirmation = this.value;
            const error = document.getElementById('password-confirmation-error');
            
            if (confirmation && password !== confirmation) {
                error.textContent = 'As senhas n√£o coincidem';
            } else {
                error.textContent = '';
            }
        });
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Auto-focus no campo de nome
        document.getElementById('nome').focus();
        
        // Mostrar erros do servidor
        {% if session.has('error') %}
            mostrarNotificacao('{{ session.get('error') }}', 'error');
        {% endif %}
        
        function mostrarNotificacao(mensagem, tipo) {
            const notificacao = document.createElement('div');
            notificacao.className = `alert alert-${tipo}`;
            notificacao.setAttribute('role', 'alert');
            notificacao.setAttribute('aria-live', 'polite');
            notificacao.textContent = mensagem;
            
            const container = document.querySelector('.container');
            container.insertBefore(notificacao, container.firstChild);
            
            setTimeout(() => {
                notificacao.remove();
            }, 5000);
        }
    </script>
{% endblock %} 
{% extends "loja/layout.twig" %}

{% block title %}Checkout - {{ empresa.nome_fantasia }}{% endblock %}

{% block content %}
    <div class="checkout-page">
        <header class="page-header">
            <h1 class="page-title">üõí Finalizar Compra</h1>
            <p class="page-subtitle">Complete seus dados para finalizar a compra</p>
        </header>

        <div class="checkout-layout">
            <!-- Formul√°rio de Checkout -->
            <main class="checkout-form">
                <form id="checkout-form" method="POST" action="/checkout/finalizar">
                    <!-- Dados Pessoais -->
                    <section class="form-section" aria-labelledby="personal-data-title">
                        <h2 id="personal-data-title" class="section-title">
                            üë§ Dados Pessoais
                        </h2>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="nome" class="form-label">Nome Completo *</label>
                                <input type="text" 
                                       id="nome" 
                                       name="nome" 
                                       class="form-input" 
                                       required
                                       value="{{ auth.user ? auth.user.nome : '' }}"
                                       aria-describedby="nome-error">
                                <div id="nome-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email" class="form-label">E-mail *</label>
                                <input type="email" 
                                       id="email" 
                                       name="email" 
                                       class="form-input" 
                                       required
                                       value="{{ auth.user ? auth.user.email : '' }}"
                                       aria-describedby="email-error">
                                <div id="email-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cpf" class="form-label">CPF *</label>
                                <input type="text" 
                                       id="cpf" 
                                       name="cpf" 
                                       class="form-input" 
                                       required
                                       placeholder="000.000.000-00"
                                       aria-describedby="cpf-error">
                                <div id="cpf-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="telefone" class="form-label">Telefone *</label>
                                <input type="tel" 
                                       id="telefone" 
                                       name="telefone" 
                                       class="form-input" 
                                       required
                                       placeholder="(00) 00000-0000"
                                       aria-describedby="telefone-error">
                                <div id="telefone-error" class="error-message" role="alert"></div>
                            </div>
                        </div>
                    </section>

                    <!-- Endere√ßo de Entrega -->
                    <section class="form-section" aria-labelledby="shipping-title">
                        <h2 id="shipping-title" class="section-title">
                            üì¶ Endere√ßo de Entrega
                        </h2>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="cep" class="form-label">CEP *</label>
                                <input type="text" 
                                       id="cep" 
                                       name="cep" 
                                       class="form-input" 
                                       required
                                       placeholder="00000-000"
                                       aria-describedby="cep-error">
                                <div id="cep-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="endereco" class="form-label">Endere√ßo *</label>
                                <input type="text" 
                                       id="endereco" 
                                       name="endereco" 
                                       class="form-input" 
                                       required
                                       placeholder="Rua, Avenida, etc."
                                       aria-describedby="endereco-error">
                                <div id="endereco-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="numero" class="form-label">N√∫mero *</label>
                                <input type="text" 
                                       id="numero" 
                                       name="numero" 
                                       class="form-input" 
                                       required
                                       placeholder="123"
                                       aria-describedby="numero-error">
                                <div id="numero-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="complemento" class="form-label">Complemento</label>
                                <input type="text" 
                                       id="complemento" 
                                       name="complemento" 
                                       class="form-input" 
                                       placeholder="Apartamento, bloco, etc.">
                            </div>
                            
                            <div class="form-group">
                                <label for="bairro" class="form-label">Bairro *</label>
                                <input type="text" 
                                       id="bairro" 
                                       name="bairro" 
                                       class="form-input" 
                                       required
                                       placeholder="Centro"
                                       aria-describedby="bairro-error">
                                <div id="bairro-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="cidade" class="form-label">Cidade *</label>
                                <input type="text" 
                                       id="cidade" 
                                       name="cidade" 
                                       class="form-input" 
                                       required
                                       placeholder="S√£o Paulo"
                                       aria-describedby="cidade-error">
                                <div id="cidade-error" class="error-message" role="alert"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="estado" class="form-label">Estado *</label>
                                <select id="estado" 
                                        name="estado" 
                                        class="form-select" 
                                        required
                                        aria-describedby="estado-error">
                                    <option value="">Selecione o Estado</option>
                                    <option value="AC">Acre</option>
                                    <option value="AL">Alagoas</option>
                                    <option value="AP">Amap√°</option>
                                    <option value="AM">Amazonas</option>
                                    <option value="BA">Bahia</option>
                                    <option value="CE">Cear√°</option>
                                    <option value="DF">Distrito Federal</option>
                                    <option value="ES">Esp√≠rito Santo</option>
                                    <option value="GO">Goi√°s</option>
                                    <option value="MA">Maranh√£o</option>
                                    <option value="MT">Mato Grosso</option>
                                    <option value="MS">Mato Grosso do Sul</option>
                                    <option value="MG">Minas Gerais</option>
                                    <option value="PA">Par√°</option>
                                    <option value="PB">Para√≠ba</option>
                                    <option value="PR">Paran√°</option>
                                    <option value="PE">Pernambuco</option>
                                    <option value="PI">Piau√≠</option>
                                    <option value="RJ">Rio de Janeiro</option>
                                    <option value="RN">Rio Grande do Norte</option>
                                    <option value="RS">Rio Grande do Sul</option>
                                    <option value="RO">Rond√¥nia</option>
                                    <option value="RR">Roraima</option>
                                    <option value="SC">Santa Catarina</option>
                                    <option value="SP">S√£o Paulo</option>
                                    <option value="SE">Sergipe</option>
                                    <option value="TO">Tocantins</option>
                                </select>
                                <div id="estado-error" class="error-message" role="alert"></div>
                            </div>
                        </div>
                    </section>

                    <!-- Op√ß√µes de Entrega -->
                    <section class="form-section" aria-labelledby="shipping-options-title">
                        <h2 id="shipping-options-title" class="section-title">
                            üöö Op√ß√µes de Entrega
                        </h2>
                        
                        <div class="shipping-options">
                            <div class="shipping-option">
                                <input type="radio" 
                                       id="shipping-standard" 
                                       name="shipping" 
                                       value="standard" 
                                       class="shipping-radio" 
                                       checked>
                                <label for="shipping-standard" class="shipping-label">
                                    <div class="shipping-info">
                                        <span class="shipping-name">Entrega Padr√£o</span>
                                        <span class="shipping-desc">5-7 dias √∫teis</span>
                                    </div>
                                    <span class="shipping-price">R$ 15,00</span>
                                </label>
                            </div>
                            
                            <div class="shipping-option">
                                <input type="radio" 
                                       id="shipping-express" 
                                       name="shipping" 
                                       value="express" 
                                       class="shipping-radio">
                                <label for="shipping-express" class="shipping-label">
                                    <div class="shipping-info">
                                        <span class="shipping-name">Entrega Expressa</span>
                                        <span class="shipping-desc">2-3 dias √∫teis</span>
                                    </div>
                                    <span class="shipping-price">R$ 25,00</span>
                                </label>
                            </div>
                            
                            <div class="shipping-option">
                                <input type="radio" 
                                       id="shipping-premium" 
                                       name="shipping" 
                                       value="premium" 
                                       class="shipping-radio">
                                <label for="shipping-premium" class="shipping-label">
                                    <div class="shipping-info">
                                        <span class="shipping-name">Entrega Premium</span>
                                        <span class="shipping-desc">1 dia √∫til</span>
                                    </div>
                                    <span class="shipping-price">R$ 35,00</span>
                                </label>
                            </div>
                        </div>
                    </section>

                    <!-- Forma de Pagamento -->
                    <section class="form-section" aria-labelledby="payment-title">
                        <h2 id="payment-title" class="section-title">
                            üí≥ Forma de Pagamento
                        </h2>
                        
                        <div class="payment-options">
                            <div class="payment-option">
                                <input type="radio" 
                                       id="payment-credit" 
                                       name="payment" 
                                       value="credit" 
                                       class="payment-radio" 
                                       checked>
                                <label for="payment-credit" class="payment-label">
                                    <span class="payment-icon">üí≥</span>
                                    <span class="payment-name">Cart√£o de Cr√©dito</span>
                                </label>
                            </div>
                            
                            <div class="payment-option">
                                <input type="radio" 
                                       id="payment-pix" 
                                       name="payment" 
                                       value="pix" 
                                       class="payment-radio">
                                <label for="payment-pix" class="payment-label">
                                    <span class="payment-icon">üì±</span>
                                    <span class="payment-name">PIX</span>
                                </label>
                            </div>
                            
                            <div class="payment-option">
                                <input type="radio" 
                                       id="payment-boleto" 
                                       name="payment" 
                                       value="boleto" 
                                       class="payment-radio">
                                <label for="payment-boleto" class="payment-label">
                                    <span class="payment-icon">üìÑ</span>
                                    <span class="payment-name">Boleto Banc√°rio</span>
                                </label>
                            </div>
                        </div>

                        <!-- Dados do Cart√£o (aparece quando selecionado) -->
                        <div id="credit-card-form" class="credit-card-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="card-number" class="form-label">N√∫mero do Cart√£o *</label>
                                    <input type="text" 
                                           id="card-number" 
                                           name="card_number" 
                                           class="form-input" 
                                           placeholder="0000 0000 0000 0000"
                                           maxlength="19">
                                </div>
                                
                                <div class="form-group">
                                    <label for="card-name" class="form-label">Nome no Cart√£o *</label>
                                    <input type="text" 
                                           id="card-name" 
                                           name="card_name" 
                                           class="form-input" 
                                           placeholder="Como est√° impresso no cart√£o">
                                </div>
                                
                                <div class="form-group">
                                    <label for="card-expiry" class="form-label">Validade *</label>
                                    <input type="text" 
                                           id="card-expiry" 
                                           name="card_expiry" 
                                           class="form-input" 
                                           placeholder="MM/AA"
                                           maxlength="5">
                                </div>
                                
                                <div class="form-group">
                                    <label for="card-cvv" class="form-label">CVV *</label>
                                    <input type="text" 
                                           id="card-cvv" 
                                           name="card_cvv" 
                                           class="form-input" 
                                           placeholder="123"
                                           maxlength="4">
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Observa√ß√µes -->
                    <section class="form-section" aria-labelledby="observations-title">
                        <h2 id="observations-title" class="section-title">
                            üìù Observa√ß√µes
                        </h2>
                        
                        <div class="form-group">
                            <label for="observacoes" class="form-label">Observa√ß√µes do Pedido</label>
                            <textarea id="observacoes" 
                                      name="observacoes" 
                                      class="form-textarea" 
                                      placeholder="Instru√ß√µes especiais para entrega, observa√ß√µes sobre o pedido, etc."
                                      rows="3"></textarea>
                        </div>
                    </section>
                </form>
            </main>

            <!-- Resumo do Pedido -->
            <aside class="order-summary">
                <div class="summary-card">
                    <h2 class="summary-title">Resumo do Pedido</h2>
                    
                    <div class="order-items">
                        {% for item in itens %}
                            <div class="order-item">
                                <div class="item-info">
                                    <span class="item-name">{{ item.produto.nome }}</span>
                                    <span class="item-quantity">Qtd: {{ item.quantidade }}</span>
                                </div>
                                <span class="item-price">R$ {{ "%.2f"|format(item.total) }}</span>
                            </div>
                        {% endfor %}
                    </div>
                    
                    <div class="summary-totals">
                        <div class="summary-row">
                            <span>Subtotal:</span>
                            <span>R$ {{ "%.2f"|format(subtotal) }}</span>
                        </div>
                        <div class="summary-row">
                            <span>Frete:</span>
                            <span id="shipping-cost">R$ 15,00</span>
                        </div>
                        {% if desconto > 0 %}
                            <div class="summary-row discount">
                                <span>Desconto:</span>
                                <span>-R$ {{ "%.2f"|format(desconto) }}</span>
                            </div>
                        {% endif %}
                        <div class="summary-row total">
                            <span>Total:</span>
                            <span id="total-cost">R$ {{ "%.2f"|format(total + 15) }}</span>
                        </div>
                    </div>
                    
                    <button type="submit" 
                            form="checkout-form" 
                            class="btn btn-primary btn-lg checkout-btn"
                            aria-label="Finalizar compra">
                        üõí Finalizar Compra
                    </button>
                    
                    <div class="security-info">
                        <div class="security-item">
                            <span class="security-icon">üîí</span>
                            <span>Pagamento Seguro</span>
                        </div>
                        <div class="security-item">
                            <span class="security-icon">üõ°Ô∏è</span>
                            <span>Dados Protegidos</span>
                        </div>
                        <div class="security-item">
                            <span class="security-icon">‚úÖ</span>
                            <span>Compra Garantida</span>
                        </div>
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <style>
        /* ===== CHECKOUT PAGE ===== */
        .checkout-page {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }
        
        .page-title {
            font-size: clamp(1.8rem, 4vw, 2.5rem);
            color: var(--text-color);
            margin-bottom: var(--spacing-sm);
        }
        
        .page-subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
        }
        
        /* ===== CHECKOUT LAYOUT ===== */
        .checkout-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: var(--spacing-lg);
            align-items: start;
        }
        
        /* ===== FORM SECTIONS ===== */
        .form-section {
            background: var(--bg-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }
        
        .section-title {
            font-size: 1.3rem;
            color: var(--text-color);
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        /* ===== FORM GRID ===== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-md);
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .form-label {
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: 2px solid var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .error-message {
            color: #dc3545;
            font-size: 0.8rem;
            min-height: 1rem;
        }
        
        /* ===== SHIPPING OPTIONS ===== */
        .shipping-options {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        .shipping-option {
            position: relative;
        }
        
        .shipping-radio {
            position: absolute;
            opacity: 0;
        }
        
        .shipping-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .shipping-radio:checked + .shipping-label {
            border-color: var(--primary-color);
            background-color: rgba(var(--primary-color-rgb), 0.05);
        }
        
        .shipping-info {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        
        .shipping-name {
            font-weight: 500;
            color: var(--text-color);
        }
        
        .shipping-desc {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .shipping-price {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        /* ===== PAYMENT OPTIONS ===== */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }
        
        .payment-option {
            position: relative;
        }
        
        .payment-radio {
            position: absolute;
            opacity: 0;
        }
        
        .payment-label {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-radio:checked + .payment-label {
            border-color: var(--primary-color);
            background-color: rgba(var(--primary-color-rgb), 0.05);
        }
        
        .payment-icon {
            font-size: 1.5rem;
        }
        
        .payment-name {
            font-weight: 500;
            color: var(--text-color);
        }
        
        /* ===== CREDIT CARD FORM ===== */
        .credit-card-form {
            display: none;
            margin-top: var(--spacing-md);
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-color);
        }
        
        .credit-card-form.show {
            display: block;
        }
        
        /* ===== ORDER SUMMARY ===== */
        .order-summary {
            position: sticky;
            top: 100px;
        }
        
        .summary-card {
            background: var(--bg-white);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
            padding: var(--spacing-lg);
        }
        
        .summary-title {
            font-size: 1.3rem;
            color: var(--text-color);
            margin-bottom: var(--spacing-lg);
        }
        
        .order-items {
            margin-bottom: var(--spacing-lg);
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-sm) 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .order-item:last-child {
            border-bottom: none;
        }
        
        .item-info {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        
        .item-name {
            font-weight: 500;
            color: var(--text-color);
        }
        
        .item-quantity {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .item-price {
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .summary-totals {
            margin-bottom: var(--spacing-lg);
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: var(--spacing-xs) 0;
        }
        
        .summary-row.discount {
            color: #28a745;
        }
        
        .summary-row.total {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
            border-top: 2px solid var(--border-color);
            padding-top: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }
        
        .checkout-btn {
            width: 100%;
            margin-bottom: var(--spacing-lg);
            font-size: 1.1rem;
            padding: var(--spacing-md);
        }
        
        .security-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        
        .security-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .security-icon {
            font-size: 1.2rem;
        }
        
        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 1024px) {
            .checkout-layout {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .order-summary {
                position: static;
            }
        }
        
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .payment-options {
                grid-template-columns: 1fr;
            }
            
            .shipping-label,
            .payment-label {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-xs);
            }
        }
        
        @media (max-width: 480px) {
            .form-section {
                padding: var(--spacing-md);
            }
            
            .summary-card {
                padding: var(--spacing-md);
            }
        }
    </style>

    <script>
        // M√°scaras para campos
        function aplicarMascara(input, mask) {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                
                if (mask === 'cpf') {
                    value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
                } else if (mask === 'telefone') {
                    value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                } else if (mask === 'cep') {
                    value = value.replace(/(\d{5})(\d{3})/, '$1-$2');
                } else if (mask === 'card') {
                    value = value.replace(/(\d{4})(\d{4})(\d{4})(\d{4})/, '$1 $2 $3 $4');
                } else if (mask === 'expiry') {
                    value = value.replace(/(\d{2})(\d{2})/, '$1/$2');
                }
                
                e.target.value = value;
            });
        }
        
        // Aplicar m√°scaras
        aplicarMascara(document.getElementById('cpf'), 'cpf');
        aplicarMascara(document.getElementById('telefone'), 'telefone');
        aplicarMascara(document.getElementById('cep'), 'cep');
        aplicarMascara(document.getElementById('card-number'), 'card');
        aplicarMascara(document.getElementById('card-expiry'), 'expiry');
        
        // Buscar CEP
        document.getElementById('cep').addEventListener('blur', function() {
            const cep = this.value.replace(/\D/g, '');
            if (cep.length === 8) {
                buscarCep(cep);
            }
        });
        
        function buscarCep(cep) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('endereco').value = data.logradouro;
                        document.getElementById('bairro').value = data.bairro;
                        document.getElementById('cidade').value = data.localidade;
                        document.getElementById('estado').value = data.uf;
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar CEP:', error);
                });
        }
        
        // Atualizar custo do frete
        document.querySelectorAll('input[name="shipping"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const shippingCost = this.value === 'standard' ? 15 : 
                                   this.value === 'express' ? 25 : 35;
                
                document.getElementById('shipping-cost').textContent = `R$ ${shippingCost.toFixed(2).replace('.', ',')}`;
                
                const subtotal = {{ subtotal }};
                const desconto = {{ desconto }};
                const total = subtotal + shippingCost - desconto;
                
                document.getElementById('total-cost').textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            });
        });
        
        // Mostrar/ocultar formul√°rio do cart√£o
        document.querySelectorAll('input[name="payment"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const creditCardForm = document.getElementById('credit-card-form');
                if (this.value === 'credit') {
                    creditCardForm.classList.add('show');
                } else {
                    creditCardForm.classList.remove('show');
                }
            });
        });
        
        // Valida√ß√£o do formul√°rio
        document.getElementById('checkout-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validarFormulario()) {
                // Simular envio
                const button = document.querySelector('.checkout-btn');
                const originalText = button.innerHTML;
                
                button.disabled = true;
                button.innerHTML = '‚è≥ Processando...';
                
                setTimeout(() => {
                    window.location.href = '/pedido/sucesso';
                }, 2000);
            }
        });
        
        function validarFormulario() {
            let isValid = true;
            
            // Limpar mensagens de erro
            document.querySelectorAll('.error-message').forEach(el => {
                el.textContent = '';
            });
            
            // Validar campos obrigat√≥rios
            const requiredFields = [
                'nome', 'email', 'cpf', 'telefone', 'cep', 'endereco', 
                'numero', 'bairro', 'cidade', 'estado'
            ];
            
            requiredFields.forEach(field => {
                const input = document.getElementById(field);
                const error = document.getElementById(field + '-error');
                
                if (!input.value.trim()) {
                    error.textContent = 'Este campo √© obrigat√≥rio';
                    isValid = false;
                }
            });
            
            // Validar email
            const email = document.getElementById('email');
            const emailError = document.getElementById('email-error');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (email.value && !emailRegex.test(email.value)) {
                emailError.textContent = 'E-mail inv√°lido';
                isValid = false;
            }
            
            // Validar CPF
            const cpf = document.getElementById('cpf');
            const cpfError = document.getElementById('cpf-error');
            
            if (cpf.value && !validarCPF(cpf.value)) {
                cpfError.textContent = 'CPF inv√°lido';
                isValid = false;
            }
            
            return isValid;
        }
        
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            if (cpf.length !== 11) return false;
            
            // Verificar d√≠gitos repetidos
            if (/^(\d)\1{10}$/.test(cpf)) return false;
            
            // Validar d√≠gitos verificadores
            let soma = 0;
            for (let i = 0; i < 9; i++) {
                soma += parseInt(cpf.charAt(i)) * (10 - i);
            }
            let resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.charAt(9))) return false;
            
            soma = 0;
            for (let i = 0; i < 10; i++) {
                soma += parseInt(cpf.charAt(i)) * (11 - i);
            }
            resto = 11 - (soma % 11);
            if (resto === 10 || resto === 11) resto = 0;
            if (resto !== parseInt(cpf.charAt(10))) return false;
            
            return true;
        }
        
        // Auto-completar dados se usu√°rio logado
        {% if auth.user %}
            document.getElementById('nome').value = '{{ auth.user.nome }}';
            document.getElementById('email').value = '{{ auth.user.email }}';
        {% endif %}
    </script>
{% endblock %} 